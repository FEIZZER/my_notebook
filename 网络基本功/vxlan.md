### VXLAN

VXLAN(vitrtual extential lan) 虚拟可拓展网络。 随着大数据，云计算， 虚拟化技术的出现， vlan技术的弊端逐渐显现。 

#### 标准

VxLAN的实现由文档rfc7348详细定义。本质上VxLAN是一种隧道技术。 通过将虚拟网络中的数据帧封装在实际物理网络报文进行传输。 具体的实现方式为： 将**虚拟网络的数据帧**添加**Vxlan首部**后， 封装在物理网络的**UDP报文**中， 然后以传统的网路通信传递UDP包。 到达目的主机后， 去掉物理网络报文头部信息和VxLAN首部， 将虚拟网络报文交付给目的终端。 整个通信过程终端不会感知到物理网络的存在。



##### VxLAN数据帧结构

数据帧的封装格式

![img](vxlan.assets/Center.png)

外部UDP包的端口值是4789， 该端口是VxLAN解析程序的默认端口， 外层IP包中源ip和目的ip则是填写通信双方的 VTEP的ip地址。 

###### VxLAN首部详解

![img](vxlan.assets/Center-1681725349811-27.png) 

VxLAN首部由8个字节构成。

- 第一个字节中标志位 **I**， 设为1表示是一个合法的VxLAN。 其余各位保留 必须置为0
- 2~4字节为 保留字段
- 5~7字节为 VxLAN标识符 VxLAN Network Identifier(VNI), 用来表示一个唯一的一个逻辑网络。
- 第8个字段仍然为保留字段。

##### 通信过程



