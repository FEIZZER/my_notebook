### jpeg图片格式

JPEG的全称是JointPhotographicExpertsGroup（联合图像专家小组），它是一种常用的图像存储格式， jpg/jpeg是24位的图像文件格式，也是一种高效率的压缩格式，文件格式是JPEG（联合图像专家组）标准的产物，该标准由ISO与CCI TT（国际电报电话咨询委员会）共同制定，是面向连续色调静止图像的一种压缩标准。可以将图像所需存储量减少至原大小的10％。有趣的是，压缩后我们对图片的所示几乎察觉不出来。

##### 前置知识

人体眼球中两种感光细胞，视杆细胞（rod cell）对色彩不太敏感，对光线敏感，可以让人在弱光环境下看东西，数量约 $10^{8}$。 视锥细胞（cone cell）对红绿蓝三色非常敏感,数量约$6*10^{6}$。由此可见, 人眼跟擅长分辨亮度而非色彩。并且人眼擅长处理高频信息，所以，jpeg格式的压缩思路就是少压缩亮度信息，多压缩高频色彩信息。

#### jpeg的压缩模式

##### 1. color space conversation 色彩空间转化

一般图片的像素由三种颜色值 RGB 组成。第一步将RGB信息转化为 Y(亮度) Cr(红度) Cb(蓝度)。计算格式一般为： 

$亮度：Y=0.299+0.587G+0.114B   蓝度：Cb=-0.1687R-0.3312G+0.5B+128$

$红度：Cr=0.5R-0.4187G-0.0813B+128$   

显然这个过程是可逆的且为产生任何的数据压缩。

##### 2. chrominance down sampling 色彩缩减取样

此步骤只处理Cr和Cb图层，每个图层中取2*2像素大小的区块，计算每个区块的色度的平均值，并将图层的大小缩减$\frac{1}{4}$ 色彩图层的数据量也就变成了$\frac{1}{4}$ ,这个过程亮度图层不会变化。==所以整体的数据量变为$\frac{1}{2}$== 。

$1+1+1 = 3 和 1+\frac{1}{4}+\frac{1}{4}=1.5$ 

##### 3. Discrete Consine Transform(DCT) 离散余弦变换

此步骤三个图层都会操作，下面以亮度图层为例：

1. 图层中取8*8像素大小的区块，每个像素的取值为[0, 255],为了方便将取值范围变成[-128, 127]
2. 取DCT spectrum（DCT算子）算子的大小为64\*(8\*8)，其实就是64个大小为(8\*8)像素块的基础图像，任何8*8的像素块(取值范围在[-128.127])都可以由者64个基础像素块组成。DCT算子分为很多，具体暂不做讨论。
3. 这样每个8*8像素大小的区块里的值可以被替换为64个基础图像的使用次数。

这个过程不会进行数据的压缩，也是可逆的。

##### 4， Quantizations 量化

量化表是一张8*8大小的表， 将64个基础图像的使用情况表中的值一一对应的除以量化表中的数字（量化表中右下角的数字较大，而基础图像中右下角则是表示高频图像）。这一步会使得右下角出现许多个0，这其实就是舍弃了人眼不擅长处理的高频部分。

*值得注意的是，色度的量化表和亮度的量化表不一样， 色度的值往往更大，意味者会舍弃更多的颜色信息，这与人眼更擅长处理亮度信息也契合。* 

#####  5. run length and Huffman Encoding游程编码和哈夫曼编码

上一步我们会得到8*8区块很大程度上都是右下角有很多零， 因此采取 “之” 字型的记录方式，将每一个区块里的只记录下来最有可能得到最多多个零聚集在一起的情况，最后这些零不会一一的表示，而是按某种方式只表示连续出现的零的个数，以此来压缩数据

##### 6. 重构图片

为了重建图片，我们基本遵循相反的步骤。

1. 我们会解游程编码，将获得的值在放回到一个个8*8的区块之中
2. 将各个区块的值乘以它当时除去的量化表，*当然当时被简化为0的值，不会在恢复了*。得到的是64个8*8的基础图像的使用情况，然后将据此将64个基础图像叠加复原原本一个个8\*8区块图像。
3. 然后将色度图层放大四倍，再转变回RGB图像后，叠加即可显示重构后的图片。



