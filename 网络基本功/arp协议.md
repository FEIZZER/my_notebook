> arp （Address Resolution Protocol，地址解析协议） 属于网络层协议是通过目的ip获得目的mac的协议。在局域网中，当主机或其它网络设备有数据要发送给另一个主机或设备时，它必须知道对方的网络层地址（即IP地址）。但是仅仅有IP地址是不够的，因为IP数据报文必须封装成帧才能通过物理网络发送，因此发送站还必须有接收站的物理地址，所以需要一个从IP地址到物理地址的映射。APR就是实现这个功能的协议。



##### arp报文结构

![ARP报文格式](http://www.bytekits.com/res/img/gather/arp/1603877232381.png) 

- 帧类型  固定为0806 表示为ARP协议类型
- HardWare Type硬件类型； 表示链路层协议
- Protocol Type协议类型； 表示网络层协议， ip协议为08 00
- 硬件地址长度： 指明了硬件MAC地址的长度 为6  表示48bit
- 协议长度：指明了高层协议地址（ip）的字节长度。
- 操作字段：用来表示这个报文的类型，ARP请求为1，ARP响应为2，RARP请求为3，RARP响应为4；
- 发送方的硬件地址（0-5字节）：源主机硬件地址,6字节；
- 发送方IP（0-3字节）：源主机硬件地址的网络地址，4字节；
- 目的硬件地址（0-5字节）：目的主机硬件地址,6字节；
- 目的IP（0-3字节）：目的主机的IP地址。发送请求时填入的是==0000::==



#### ARP分类

##### 免费/无辜 arp（free arp）

免费arp是一种特殊的arp请求， 报文中源ip和目的ip都是发送方自己的ip。

###### 免费arp触发时机

1. 接口link关闭后又开启，会广播通知大家。每台tcp/ip协议的三层交设备都会根据新收到的免费arp更新自己的arp表
2. ip地址变动，比如重新配置了自己的ip地址。设备会主动的发送免费arp告知 ip和mac地址的变动。
3. 重插网卡（修改了自己的mac地址）
4. vrrp的浮动ip的切换也会主动发送免费的ARP请求 ==不懂==

###### 免费arp的作用

1. 可以把设备的ip和mac关系变动通知到全网，及时更新全网的arp表资源
2. 免费arp可以用于做ip地址冲突检测。



##### arp代理



##### 