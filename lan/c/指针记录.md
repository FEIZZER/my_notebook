### C语言中的指针

我们将c语言程序 内存中的**字节编号**称为**地址(Address)**或**指针(Pointer)** 。地址从0开始递增， 对于32为的机器，C语言可用的内存空间为4GB, 范围 [0, 0XFFFFFFFF] 。

CPU访问到内存中数据需要的是地址，而不是变量名或函数名。 变量名和函数名只是一种助记符，它们最后都会替换成地址。 编译和链接过程中的一项重要任务就是找到符号对于的地址。

#### c语言中指针变量运算

指针变量保存的是一个地址，他的本质其实还是一个整数， 所以指针也可以进行加减等运算符操作。

```c
#include <stdio.h>
int main()
{
    int *p;
    char *c;
    printf("p=%#X, c=%#X \n", p, c);
    p++, c++;
    printf("p=%#X, c=%#X \n", p, c);
}
//p=0, c=0XC7A1BE50
//p=0X4, c=0XC7A1BE51
```

指针类型的变量每次自增， 都会相加等于自身类型长度的数值。 *int类型加4， char类型加1*。

指针类型也可以进行 `== ` 判断, 比较的是其自身的值是否相等*（就是他们代表的地址是否是同一个）*

另外， 指针类型无法进行乘除取余操作， 语法直接不允许。



#### C语言的数组指针

`int arr[4] = {1, 2, 3, 4}`  定义了一个数组， arr是数组名，**用来表示整个数组**，也就是多份数据的集合。 但是在使用的过程中**经常转化为表示第一个元素的指针**。 *但是注意的数组名并不等于指向数组第一个元素的指针。* 

一个指向数组元素的指针就是 **数组指针**。下面的代码使用数组指针遍历查看了数组中的元素。 

```c
#include <stdio.h>
int main(){
    int arr[] = { 99, 15, 100, 888, 252 };
    int i, *p = arr, len = sizeof(arr) / sizeof(int);
    for(i=0; i<len; i++){
        printf("%d  ", *p++ );
    }
    printf("\n");
    return 0;
}
```

注意使用 *(p+1) 访问数组元素时，可能不能及时发现超出下标的情况。

##### 指针和数组名 语法的交叉

- 指针使用下标   当一个指针指向数组元素时， 也可以用 `p[i]` 来访问数组元素， 等价于 `*(p+1)`。 

- 数组名使用运算符  数组名也可以使用 `*(arr+i)` 来访问数组元素



##### 数组名详解

数组名并不能完全当成指向数组第一个元素的指针。  一些数组名的特性

- 数组名是一个常量指针， 他不能被重新赋值

- 对数组名使用`sizeof(arr)` 得到的不是指针类型的长度， 而是整个数组元素所占的长度

- **当数组作为函数参数传递时， 函数内入参会退化为一个普通的指针变量**

  ```c
  #include <stdio.h>
  
  int main()
  {
      int p[5] = {1, 2, 3, 4};
      printf("p=%d  \n", sizeof(p));
      test(p);
  }
  
  int test(int num[]) {
      printf("num=%d, sizeof(num)=%d \n", *num, sizeof(num));
      *num = 9;
      printf("num=%d \n", *num);
  }
  // p=20
  // num=1, sizeof(num)=8  
  // num=9
  ```

  此时在函数内部这个数组入参已经退化为一个普通的指针变量， 可以被重新赋值， `sizeof(num)` 得到的就是指针类型的长度。 *c语言中指针类型占一个机器字长， 64位机器占8字节*

  

#### c语言的字符串指针

C语言中字符串可以通过数组和指针两种方式声明

```c
char str1[] = "hello world!";
char *str2 = "hello world again!";
```

可以通过 string.h文件中的 `strlen(str1)` 方式计算字符串的长度*（因为c编译器会自动给字符串结尾加上 '\0' 字符， 表示结尾）*

##### 存储区域的区别

这两种方式声明的字符串时存储在不同的存储区域。 字符数组存储在全局数据区或栈区，第二种形式的字符串存储在常量区。全局数据区和栈区的字符串（也包括其他数据）有读取和写入的权限，而常量区的字符串（也包括其他数据）只有读取权限，没有写入权限。

![image-20230703093133902](指针记录.assets/image-20230703093133902.png)x