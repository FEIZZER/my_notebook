## ELF(Executable Linkable Format)

linux下的ELF文件又被分为如下的四类:

- **可重定位文件/目标文件 Relocatable File** 这类文件包含了代码和数据, 可以被用来链接成可执行文件或共享目标文件文件. *静态链接库也可以归为这一类, 静态库是把很多目标文件捆绑到一起, 再加上一些索引, 所以也可以归为这一类*
- **可执行文件 Executable File**  这类文件就是可执行文件, 一般没有拓展名.
- **共享目标文件 Shared Object File** 这类文件包含代码和数据. 可以再两种情况下使用:
  - 链接器使用这种文件和其他的可重定位文件链接,产生新的可重定位目标文件
  - 动态链接器将这种共享文件域可执行文件与可执行文件结合, 作为可执行映像的一部分运行.
- **核心转储文件Core Dump File** 当进程意外终止, 系统可以将进程的地址空间的内容和终止的其他信息转储到核心存储文件.



### .o目标文件结构分析

#### linux下未链接的目标文件结构

*注:windows下即使使用 gcc编译地得到 .o文件, 其结构也不是 linux下的elf文件, 会略有偶差异*

可以使用 `objdump`或 `readelf` 工具查看目标文件的基本信息.  objdump和readelf工具的使用方法不赘述.

![image-20240115110324514](./ELF%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90.assets/image-20240115110324514.png) 

- 其中 .text是最基本的代码段, 一般代码执行语句被编译成机器语言, 保存在该段. 
- .data段是数据段, 已经初始化的全局变量和静态局部变量保存在其中.  
- .bss段中一般存放未初始化的全局变量和局部静态变量, 未初始化的变量其实也是可以存放在data段的, 但是未初始化就是0, 所以在data段分配空间存放0值毫无意义. 所以使用一个空段bss为这些变量预留位置, 在上图也可以看到 bss段的长度为0.
- .rodata/.rdata 只读数据段 存放了程序中的只读的数据, 如const修饰的变量和字符常量
- .dynamic  的动态链接信息段
- .comment 注释信息段
- .note.GNU-stack 堆栈提示段

*需要注意的是, 上述某段存放某类数据, 是由编译器实现, 尽管不同的编译器工作大致相同, 但器实现可能大相径庭. 比如有的编译器会将字符常量也放在 data段*

ELF文件中其他常见的段



##### 自定义段

有时候可能希望定义的变量被放到指定的段中, gcc提供了一直拓展机制, 

```c
__attribute__((section("FOO"))) int myVar = 45;
```



#### ELF结构代码描述



